{% extends "base.html" %}
{% block content %}
<div class="space-y-6">
    <div class="flex justify-between items-center">
        <h1 class="text-4xl font-bold text-gray-800"><i class="fas fa-clipboard-check text-green-600 mr-2"></i>Registrar Asistencia</h1>
    </div>
    
    {% if grades_data %}
        {% for grade_id, data in grades_data.items() %}
        <div class="space-y-4">
            <div class="bg-gradient-to-r from-green-600 to-green-700 text-white p-4 rounded-lg">
                <h2 class="text-2xl font-bold">{{ data.grade.name }}</h2>
            </div>
            
            <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                <table class="w-full">
                    <thead class="bg-gradient-to-r from-green-600 to-green-700 text-white">
                        <tr>
                            <th class="px-6 py-4 text-left">Estudiante</th>
                            <th class="px-6 py-4 text-left">Fecha</th>
                            <th class="px-6 py-4 text-left">Estado</th>
                            <th class="px-6 py-4 text-left">Acci√≥n</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y">
                        {% for student in data.students %}
                        {% set enrollment = data.enrollments|selectattr('student_id', 'equalto', student.id)|first %}
                        <tr class="hover:bg-sky-50">
                            <td class="px-6 py-4 font-semibold">{{ student.user.name }}</td>
                            <td class="px-6 py-4">
                                {% if enrollment %}
                                <form method="POST" class="flex gap-2 items-center" style="display:flex; gap: 0.5rem;">
                                    <input type="hidden" name="enrollment_id" value="{{ enrollment.id }}">
                                    <input type="date" name="attendance_date" required class="px-3 py-2 bg-sky-50 border-2 border-sky-200 rounded text-sm">
                                    <select name="status" required class="px-3 py-2 bg-sky-50 border-2 border-sky-200 rounded text-sm">
                                        <option value="">Estado</option>
                                        <option value="present">Presente</option>
                                        <option value="absent">Ausente</option>
                                        <option value="late">Llega Tarde</option>
                                        <option value="excused">Justificado</option>
                                    </select>
                                    <button type="submit" class="bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded text-sm font-bold">
                                        <i class="fas fa-save"></i>
                                    </button>
                                </form>
                                {% else %}
                                <span class="text-gray-400 text-sm">No inscrito en cursos</span>
                                {% endif %}
                            </td>
                            <td class="px-6 py-4 text-sm">-</td>
                            <td class="px-6 py-4">-</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        {% endfor %}
    {% else %}
    <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 rounded">
        <p class="font-semibold">No hay cursos asignados</p>
        <p class="text-sm">Solicita al administrador que te asigne cursos para registrar asistencia.</p>
    </div>
    {% endif %}
</div>
{% endblock %}
