{% extends "base.html" %}

{% block title %}Asistencia - Sistema de Gestión Académica{% endblock %}

{% block content %}
<div class="space-y-6">
    <div class="flex justify-between items-center">
        <div>
            <h1 class="text-4xl font-bold text-gray-800 flex items-center gap-3">
                <i class="fas fa-clipboard-check text-green-600"></i> Registro de Asistencia
            </h1>
            <p class="text-gray-500 mt-2">Gestiona la asistencia de estudiantes</p>
        </div>
        <button onclick="openModal('newAttendanceModal')" class="gradient-btn text-white px-6 py-3 rounded-lg transition font-bold flex items-center gap-2">
            <i class="fas fa-plus"></i> Registrar Asistencia
        </button>
    </div>

    <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
        <table class="w-full">
            <thead class="bg-gradient-to-r from-sky-600 to-sky-700 text-white">
                <tr>
                    <th class="px-6 py-4 text-left">Estudiante</th>
                    <th class="px-6 py-4 text-left">Fecha</th>
                    <th class="px-6 py-4 text-left">Estado</th>
                    <th class="px-6 py-4 text-left">Notas</th>
                </tr>
            </thead>
            <tbody class="divide-y">
                {% for att in attendance[-20:] %}
                <tr class="hover:bg-sky-50 transition">
                    <td class="px-6 py-4 font-semibold text-gray-800">{{ att.enrollment.student.user.name }}</td>
                    <td class="px-6 py-4 text-gray-600">{{ att.date }}</td>
                    <td class="px-6 py-4">
                        <span class="px-3 py-1 rounded-full text-xs font-bold {% if att.status == 'present' %}bg-green-100 text-green-800{% elif att.status == 'absent' %}bg-red-100 text-red-800{% else %}bg-yellow-100 text-yellow-800{% endif %}">
                            {{ att.status|upper }}
                        </span>
                    </td>
                    <td class="px-6 py-4 text-gray-600">{{ att.notes or '-' }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div id="newAttendanceModal" style="display:none" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-2xl p-8 max-w-md border-t-4 border-green-500 shadow-2xl">
        <h2 class="text-2xl font-bold mb-6 text-gray-800">Registrar Asistencia</h2>
        <form method="POST" action="{{ url_for('mark_attendance') }}" class="space-y-5">
            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Estudiante</label>
                <input type="text" name="enrollment_id" required placeholder="ID Inscripción" class="w-full px-4 py-3 bg-sky-50 border-2 border-sky-200 rounded-lg focus:outline-none focus:border-sky-500 text-gray-800">
            </div>
            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Fecha</label>
                <input type="date" name="date" required class="w-full px-4 py-3 bg-sky-50 border-2 border-sky-200 rounded-lg focus:outline-none focus:border-sky-500 text-gray-800">
            </div>
            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Estado</label>
                <select name="status" required class="w-full px-4 py-3 bg-sky-50 border-2 border-sky-200 rounded-lg focus:outline-none focus:border-sky-500 text-gray-800">
                    <option value="present">Presente</option>
                    <option value="absent">Ausente</option>
                    <option value="late">Retardo</option>
                </select>
            </div>
            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Notas</label>
                <textarea name="notes" rows="3" placeholder="Observaciones..." class="w-full px-4 py-3 bg-sky-50 border-2 border-sky-200 rounded-lg focus:outline-none focus:border-sky-500 text-gray-800"></textarea>
            </div>
            <div class="flex gap-3 pt-4">
                <button type="submit" class="flex-1 gradient-btn text-white py-3 rounded-lg transition font-bold">Guardar</button>
                <button type="button" onclick="closeModal('newAttendanceModal')" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-800 py-3 rounded-lg transition font-bold">Cancelar</button>
            </div>
        </form>
    </div>
</div>

<script>
function openModal(id) { document.getElementById(id).style.display = 'flex'; }
function closeModal(id) { document.getElementById(id).style.display = 'none'; }
</script>
{% endblock %}
